<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tun Barbers - Appointments</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        button { background: #4CAF50; color: white; border: none; padding: 10px 15px; cursor: pointer; }
    </style>
</head>
<body>
    <h1>Book an Appointment</h1>
    <input type="datetime-local" id="appointmentTime">
    <button id="bookBtn">Book Now</button>
    <div id="status"></div>

    <!-- Firebase & OneSignal SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-database-compat.js"></script>
    <script src="https://cdn.onesignal.com/sdks/web/v16/OneSignalSDK.page.js"></script>

    <script>
        // Firebase Config
        const firebaseConfig = {
            apiKey: "AIzaSyBMJuAmIAqDUXhZcGBHq8CszhJL92VaZ64",
            authDomain: "information-project1.firebaseapp.com",
            databaseURL: "https://information-project1-default-rtdb.firebaseio.com",
            projectId: "information-project1",
            storageBucket: "information-project1.appspot.com",
            messagingSenderId: "1098270976013",
            appId: "1:1098270976013:web:2e1ca7602b316b6ed30d44"
        };

        // Initialize Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // Initialize OneSignal
        window.OneSignal = window.OneSignal || [];
        OneSignal.push(function() {
            OneSignal.init({
                appId: "26d8ce26-717a-4021-b5ce-b616e2d62dc9", // Replace with your ID
                serviceWorkerPath: "/firebase-messaging-sw.js",
                notifyButton: { enable: false }
            });
        });

        // Book Appointment
        document.getElementById("bookBtn").addEventListener("click", async () => {
            const time = document.getElementById("appointmentTime").value;
            if (!time) return alert("Please select a time!");

            // Get OneSignal User ID
            const userId = await OneSignal.getUserId();
            
            // Save to Firebase
            db.ref("appointments").push({
                userId: userId,
                time: new Date(time).toISOString(),
                status: "confirmed"
            });

            // Schedule notifications via Render backend
            fetch("https://your-render-service.onrender.com/schedule-notification", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    userId: userId,
                    title: "âœ… Appointment Booked",
                    message: "Your appointment is confirmed!",
                    sendTime: new Date(Date.now() + 60000).toISOString() // 1 min later
                })
            });

            document.getElementById("status").textContent = "Appointment booked!";
        });
    </script>
</body>
</html>
